<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Al Madani Learning Hub - Kelas 6</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --primary:#2563eb;
  --text:#334155;
  --muted:#64748b;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:linear-gradient(135deg,#e0e7ff,#f8fafc);
  color:var(--text);
}

.container{
  max-width:900px;
  margin:auto;
  padding:24px;
}

header{
  text-align:center;
  margin-bottom:24px;
}

.home-link{
  text-decoration:none;
  color:inherit;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:20px;
}

.card{
  background:white;
  border-radius:16px;
  padding:28px 20px;
  text-align:center;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
  cursor:pointer;
  transition:.25s;
}

.card:hover{
  transform:translateY(-6px);
  box-shadow:0 18px 40px rgba(0,0,0,.15);
}

.card-icon{font-size:2.5rem;margin-bottom:12px}
.card-title{font-weight:600}

/* ===== Controls ===== */
.controls{
  display:flex;
  gap:10px;
  justify-content:center;
  margin:16px 0;
  flex-wrap:wrap;
}

button{
  background:var(--primary);
  color:white;
  border:none;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
}

/* ===== Row & Ranking ===== */
.row{
  background:white;
  padding:14px;
  border-radius:12px;
  margin-bottom:10px;
  animation:fadeIn .4s ease;
}

@keyframes fadeIn{
  from{opacity:0;transform:translateY(6px)}
  to{opacity:1;transform:none}
}

.row-top{
  display:flex;
  justify-content:space-between;
  font-weight:bold;
}

/* ===== Progress Color ===== */
.low{
  border-left:6px solid #ef4444;
  background:#fef2f2;
}
.mid{
  border-left:6px solid #f59e0b;
  background:#fffbeb;
}
.high{
  border-left:6px solid #22c55e;
  background:#f0fdf4;
}
.full{
  border-left:6px solid #15803d;
  background:#dcfce7;
}

.bar-container{
  background:#ddd;
  height:10px;
  border-radius:6px;
  overflow:hidden;
  margin:6px 0;
}
.bar{
  height:100%;
  background:var(--primary);
  transition:width .6s ease;
}

.stars{font-size:.85rem}

/* ===== Loader ===== */
.loader{
  display:flex;
  justify-content:center;
  margin-top:40px;
}
.spinner{
  width:40px;
  height:40px;
  border:5px solid #ddd;
  border-top:5px solid var(--primary);
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>
<div class="container">

<header>
  <h1>
    <a class="home-link" href="http://aturkata.my.id/almadani/">
      Al Madani Learning Hub
    </a>
  </h1>
  <p>Kelas 6 ‚Äì Kuis</p>
</header>

<main id="content"></main>

</div>

<script>
const API_BASE="https://script.google.com/macros/s/AKfycbziID9ytwg6hpHqOUwJbiRyH07gK9XvP08A3KnJNL47M8AN-o-yAibU0Bs_9HOhdP6Hrw/exec";
const MAX_CHECKBOX=40;

let sheets=[];
let currentData=[];
let rankingOn=false;
let filterOn=false;

/* ===== Helpers ===== */
function getIcon(n){
  n=n.toLowerCase();
  if(n.includes("kuis"))return"üìù";
  if(n.includes("paket"))return"üì¶";
  return"üìò";
}

function getLevel(p){
  if(p<40)return"low";
  if(p<80)return"mid";
  if(p<100)return"high";
  return"full";
}

function getRankIcon(i){
  if(i===0)return"ü•á";
  if(i===1)return"ü•à";
  if(i===2)return"ü•â";
  return"üéØ";
}

/* ===== Home ===== */
function showHome(){
  rankingOn=false;
  filterOn=false;

  let html=`<section class="grid">`;
  sheets.forEach(s=>{
    html+=`
      <div class="card" onclick="loadSheet('${s}')">
        <div class="card-icon">${getIcon(s)}</div>
        <div class="card-title">${s}</div>
      </div>`;
  });
  html+=`</section>`;
  content.innerHTML=html;
}

/* ===== Load ===== */
function loadSheet(sheet){
  content.innerHTML=`<div class="loader"><div class="spinner"></div></div>`;
  fetch(`${API_BASE}?sheet=${sheet}`)
    .then(r=>r.json())
    .then(d=>{
      currentData=d;
      rankingOn=false;
      filterOn=false;
      render(sheet);
    });
}

/* ===== Render ===== */
function render(sheet){
  let data=[...currentData];

  if(filterOn){
    data=data.filter(d=>(d.jumlah/MAX_CHECKBOX*100)<40);
  }

  if(rankingOn){
    data.sort((a,b)=>b.jumlah-a.jumlah);
  }

  let html=`
    <h2>${sheet}</h2>
    <div class="controls">
      <button onclick="toggleRank()">
        ${rankingOn?"Urutan Asli":"Ranking"}
      </button>
      <button onclick="toggleFilter()">
        ${filterOn?"Tampilkan Semua":"Belum Tuntas"}
      </button>
      <button onclick="showHome()">Kembali</button>
    </div>
  `;

  data.forEach((d,i)=>{
    const pct=Math.round(d.jumlah/MAX_CHECKBOX*100);
    const cls=getLevel(pct);
    const icon=rankingOn?getRankIcon(i)+" ":"";

    html+=`
      <div class="row ${cls}">
        <div class="row-top">
          <span>${icon}${d.nama}</span>
          <span>${pct}%</span>
        </div>
        <div class="bar-container">
          <div class="bar" style="width:${pct}%"></div>
        </div>
        <div class="stars">${"‚≠ê".repeat(d.jumlah)}</div>
      </div>
    `;
  });

  content.innerHTML=html;
}

/* ===== Toggles ===== */
function toggleRank(){rankingOn=!rankingOn;render(document.querySelector("h2").innerText)}
function toggleFilter(){filterOn=!filterOn;render(document.querySelector("h2").innerText)}

/* ===== Init ===== */
fetch(`${API_BASE}?action=list`)
  .then(r=>r.json())
  .then(l=>{sheets=l;showHome()});
</script>
<footer>
      ¬© 2026 Almadani ‚Ä¢ Powered by <a href="https://arkanin.my.id" target="_blank">Arkanin</a>

    </footer>
</body>
</html>
