<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAN 4 Banjar Learning Hub</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;}
body{min-height:100vh;background:linear-gradient(135deg,#f5f7fa,#e4ecf7);display:flex;flex-direction:column;align-items:center;padding:0 1rem;}

/* HEADER */
header{text-align:center;padding:2rem 1rem;width:100%;}
header h1{font-size:2rem;margin-bottom:0.5rem;cursor:pointer;color:#1f3c88;}
header h1:hover{text-decoration:underline;}
header p{font-size:1rem;color:#555;}

/* SEARCH */
#search{width:50%;padding:0.8rem 1rem;margin:1rem 0;font-size:1rem;border-radius:10px;border:1px solid #ccc;}

/* LOADER */
#loader{display:none;width:50px;height:50px;border:5px solid #f3f3f3;border-top:5px solid #1f3c88;border-radius:50%;animation:spin 1s linear infinite;margin:2rem auto;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}

/* GRID CARD */
#cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;width:100%;max-width:1100px;}

.card{border-radius:20px;padding:1.8rem;box-shadow:0 12px 28px rgba(0,0,0,0.1);cursor:pointer;transition:transform 0.3s ease, box-shadow 0.3s ease, filter 0.3s ease,color 0.3s;text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.card:hover{transform:translateY(-5px);box-shadow:0 20px 40px rgba(0,0,0,0.2);filter:brightness(1.1);}
.card-icon{font-size:2.5rem;margin-bottom:0.8rem;transition:transform 0.3s ease;}
.card:hover .card-icon{transform:scale(1.1) rotate(-3deg);}
.card h2{font-size:1.1rem;margin-bottom:0.4rem;word-break:break-word;}
.card p{font-size:0.85rem;line-height:1.4;color:#f1f1f1;}

/* CARD COLORS */
.lab{background:linear-gradient(135deg,#45f232,#3f72af);}
.kir{background:linear-gradient(135deg,#2d6a4f,#52b788);}
.sc{background:linear-gradient(135deg,#9d0208,#f48c06);}

.lab h2 { color: #fff; } /* bisa ganti sesuai keinginan */
  
/* POPUP VIEWER */
#viewerOverlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;pointer-events:none;transition:opacity 0.3s ease;flex-direction:column;}
#viewerOverlay.show{opacity:1;pointer-events:auto;}
#viewerWrapper{position:relative;width:90%;height:80%;max-width:800px;max-height:80vh;background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 0 30px rgba(0,0,0,0.5);display:flex;flex-direction:column;}
#viewerWrapper iframe{width:100%;height:100%;border:none;transform:scale(0.95);transition:transform 0.3s ease;}
#viewerOverlay.show iframe{transform:scale(1);}
#viewerWrapper .closeBtn{position:absolute;top:8px;right:8px;z-index:10;font-size:1.2rem;color:#fff;cursor:pointer;font-weight:bold;background:rgba(0,0,0,0.5);padding:4px 8px;border-radius:6px;transition:background 0.3s;}
#viewerWrapper .closeBtn:hover{background:rgba(0,0,0,0.8);}
#popupLoader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:40px;height:40px;border:5px solid #f3f3f3;border-top:5px solid #1f3c88;border-radius:50%;animation:spin 1s linear infinite;display:none;}

/* PAGINATION */
#pagination{text-align:center;margin:1.5rem 0;display:flex;justify-content:center;gap:0.3rem;flex-wrap:wrap;}
#pagination button{padding:0.5rem 0.8rem;border:none;border-radius:5px;background:#1f3c88;color:#fff;cursor:pointer;transition:0.3s, transform 0.2s;}
#pagination button:hover{background:#3f72af;transform:scale(1.05);}
#pagination button.active{background:#45f232;transform:scale(1.05);font-weight:bold;}

/* FOOTER */
footer{text-align:center;padding:1rem;width:100%;background: rgba(255,255,255,0.7);backdrop-filter: blur(6px);font-size:0.9rem;margin-top:auto;}
footer a{color:#1f3c88;text-decoration:none;font-weight:600;}
footer a:hover{text-decoration:underline;}

/* RESPONSIVE */
@media(max-width:768px){
  #cards{grid-template-columns:1fr;gap:1rem;}
  .card{padding:1rem;min-height:130px;}
  .card-icon{font-size:2rem;margin-bottom:0.5rem;}
  .card h2{font-size:1rem;}
  .card p{font-size:0.8rem;}
  #viewerWrapper{width:95%;height:70%;max-height:70vh;}
  #viewerWrapper .closeBtn{top:6px;right:6px;font-size:1rem;padding:3px 6px;}
  #popupLoader{width:30px;height:30px;border-width:4px;}
}
</style>
</head>
<body>

<header>
  <h1 onclick="window.location.href='https://aturkata.my.id/m4b'">M4B Learning Hub</h1>
  <h1>Lab IPA MAN 4 Banjar</h1>
  <p>Thinks Globally, Act Locally</p>
</header>

<div style="text-align:center; margin:2rem 0;">
  <h2 style="font-size:1.8rem; color:#1f3c88; margin-bottom:0.5rem;">Prosedur Pengajuan</h2>
  <p style="font-size:1rem; color:#555; margin-top:0;">Segera hadir</p>
</div>

  <div style="text-align:center; margin:2rem 0;">
  <h2 style="font-size:1.8rem; color:#1f3c88; margin-bottom:0.5rem;">Inventarisasi Alat dan Bahan</h2>
  <p style="font-size:1rem; color:#555; margin-top:0;">Segera hadir</p>
</div>

  <div style="text-align:center; margin:2rem 0;">
  <h2 style="font-size:1.8rem; color:#1f3c88; margin-bottom:0.5rem;">Jadwal Praktikum</h2>
  <p style="font-size:1rem; color:#555; margin-top:0;">Segera hadir</p>
</div>

  
<div style="text-align:center; margin:2rem 0;">
  <h2 style="font-size:1.8rem; color:#1f3c88; margin-bottom:0.5rem;">Daftar Modul Praktikum</h2>
  </div>

<input id="search" placeholder="Cari modul..." />
<div id="loader"></div>
<div id="cards"></div>
<div id="pagination"></div>

<!-- POPUP VIEWER -->
<div id="viewerOverlay">
  <div id="viewerWrapper">
    <span class="closeBtn">&times;</span>
    <div id="popupLoader"></div>
    <iframe src="" style="display:none;"></iframe>
  </div>
</div>

<footer>
  <p>Powered by <a href="https://arkanin.my.id" target="_blank">Arkanin</a></p>
</footer>

<script>
const DATA_URL = 'https://script.google.com/macros/s/AKfycbxP9Jun4DV7or8KJZAJ3hlEZ16J77GbK_v8vorluTjqI0Mp6nRRWPezpGWLRpEniUTthw/exec';
const cardsContainer=document.getElementById('cards');
const search=document.getElementById('search');
const paginationContainer=document.getElementById('pagination');
const loader=document.getElementById('loader');

let allData=[];
let currentPage=1;
const itemsPerPage=5; // tampilkan 7 card per halaman
const pageDisplay=5;   // maksimal tombol pagination

// POPUP
const overlay=document.getElementById('viewerOverlay');
const wrapper=document.getElementById('viewerWrapper');
const iframe=wrapper.querySelector('iframe');
const closeBtn=wrapper.querySelector('.closeBtn');
const popupLoader=document.getElementById('popupLoader');
closeBtn.onclick=()=>{ overlay.classList.remove('show'); iframe.src=''; iframe.style.display='none'; popupLoader.style.display='none'; }

// OPEN VIEWER
function openViewer(file_id){
  overlay.classList.add('show');
  popupLoader.style.display='block';
  iframe.style.display='none';
  iframe.src=`https://docs.google.com/gview?url=https://drive.google.com/uc?id=${file_id}&embedded=true`;
  iframe.onload=()=>{
    popupLoader.style.display='none';
    iframe.style.display='block';
  };
}

// RENDER KARTU
function renderPage(page=1,data=allData){
  cardsContainer.innerHTML='';
  const start=(page-1)*itemsPerPage;
  const end=start+itemsPerPage;
  const pageData=data.slice(start,end);

  pageData.forEach(d=>{
    const div=document.createElement('div');
    const categoryClass=d.category?.toLowerCase()||'lab';
    div.className=`card ${categoryClass}`;
    div.innerHTML=`
      <div class="card-icon">ðŸ“„</div>
      <h2>${d.title}</h2>
      <p>Klik untuk lihat modul</p>`;
    div.onclick=()=>openViewer(d.file_id);
    cardsContainer.appendChild(div);
  });

  renderPagination(data,page);
}

// PAGINATION DENGAN PREV / NEXT
function renderPagination(data,page){
  paginationContainer.innerHTML='';
  const pageCount=Math.ceil(data.length/itemsPerPage);
  if(pageCount<=1) return;

  // tombol Previous
  const prevBtn=document.createElement('button');
  prevBtn.textContent='Â« Prev';
  prevBtn.disabled=page===1;
  prevBtn.onclick=()=>{
    if(page>1){ currentPage--; renderPage(currentPage,data); window.scrollTo(0,0); }
  };
  paginationContainer.appendChild(prevBtn);

  // tombol nomor halaman
  let startPage=Math.max(1,page-Math.floor(pageDisplay/2));
  let endPage=Math.min(pageCount,startPage+pageDisplay-1);
  startPage=Math.max(1,endPage-pageDisplay+1);

  for(let i=startPage;i<=endPage;i++){
    const btn=document.createElement('button');
    btn.textContent=i;
    if(i===page) btn.classList.add('active');
    btn.onclick=()=>{
      currentPage=i; 
      renderPage(currentPage,data);
      window.scrollTo(0,0);
    };
    paginationContainer.appendChild(btn);
  }

  // tombol Next
  const nextBtn=document.createElement('button');
  nextBtn.textContent='Next Â»';
  nextBtn.disabled=page===pageCount;
  nextBtn.onclick=()=>{
    if(page<pageCount){ currentPage++; renderPage(currentPage,data); window.scrollTo(0,0); }
  };
  paginationContainer.appendChild(nextBtn);
}

// FETCH DATA DENGAN LOADER
loader.style.display='block';
fetch(DATA_URL)
.then(r=>r.json())
.then(data=>{
  allData=data;
  loader.style.display='none';
  renderPage(currentPage);
})
.catch(err=>{
  loader.style.display='none';
  cardsContainer.innerHTML='<p style="text-align:center;">Gagal memuat data</p>';
});

// SEARCH
search.oninput=()=>{
  const q=search.value.toLowerCase();
  const filtered=allData.filter(d=>d.title.toLowerCase().includes(q));
  currentPage=1;
  renderPage(currentPage,filtered);
};
</script>

</body>
</html>
