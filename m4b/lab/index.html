<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MAN 4 Banjar Learning Hub</title>

  <style>
    * { box-sizing:border-box; margin:0; padding:0; font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif; }
    body { min-height:100vh; background:linear-gradient(135deg,#f5f7fa,#e4ecf7); color:#333; padding:1rem; display:flex; flex-direction:column; }

    /* HEADER */
    header { text-align:center; padding:2rem 1rem; }
    header h1 { font-size:2rem; margin-bottom:0.5rem; cursor:pointer; color:#1f3c88; }
    header h1:hover { text-decoration:underline; }
    header p { font-size:1rem; color:#555; }

    /* SEARCH BAR */
    #search { width:100%; padding:0.8rem 1rem; margin:1rem 0; font-size:1rem; border-radius:10px; border:1px solid #ccc; }

    /* GRID CARD */
    #cards { display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:1.6rem; }

    .card { border-radius:20px; padding:2rem 1.8rem; box-shadow:0 12px 28px rgba(0,0,0,0.1); cursor:pointer;
           transition: transform 0.3s ease, box-shadow 0.3s ease, filter 0.3s ease; color:#fff; text-align:center; position:relative; }
    .card:hover { transform:translateY(-5px); box-shadow:0 20px 40px rgba(0,0,0,0.2); filter: brightness(1.1); }
    .card-icon { font-size:3rem; margin-bottom:0.8rem; transition: transform 0.3s ease; }
    .card:hover .card-icon { transform:scale(1.1) rotate(-3deg); }
    .card h2 { font-size:1.2rem; margin-bottom:0.4rem; }
    .card p { font-size:0.9rem; line-height:1.4; color:#f1f1f1; }

    /* CARD COLORS BY CATEGORY */
    .lab { background: linear-gradient(135deg,#1f3c88,#3f72af);}
    .kir { background: linear-gradient(135deg,#2d6a4f,#52b788);}
    .sc  { background: linear-gradient(135deg,#9d0208,#f48c06);}

    /* POPUP VIEWER */
    #viewerOverlay {
      position:fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.7); display:none; align-items:center; justify-content:center;
      z-index:1000; opacity:0; transition: opacity 0.3s ease;
    }
    #viewerOverlay.show { display:flex; opacity:1; }
    #viewerOverlay iframe { width:90%; height:90%; border:none; border-radius:10px; box-shadow:0 0 30px rgba(0,0,0,0.5); transform:scale(0.8); transition: transform 0.3s ease;}
    #viewerOverlay.show iframe { transform:scale(1); }
    #viewerOverlay .closeBtn { position:absolute; top:15px; right:20px; font-size:1.5rem; color:#fff; cursor:pointer; font-weight:bold; }

    /* PAGINATION */
    #pagination { margin:1.5rem 0; text-align:center; }
    #pagination button { margin:0 0.25rem; padding:0.5rem 0.8rem; border:none; border-radius:5px; background:#1f3c88; color:#fff; cursor:pointer; transition:0.3s; }
    #pagination button:hover { background:#3f72af; }
    #pagination button.active { background:#162d66; }

    /* FOOTER */
    footer { text-align:center; padding:1rem; background: rgba(255,255,255,0.7); backdrop-filter: blur(6px); font-size:0.9rem; margin-top:auto; }
    footer a { color:#1f3c88; text-decoration:none; font-weight:600; }
    footer a:hover { text-decoration:underline; }

    /* RESPONSIVE */
    @media(max-width:768px){#cards{grid-template-columns:1fr; gap:1.4rem;}}
  </style>
</head>
<body>

<header>
  <h1 onclick="window.location.href='https://aturkata.my.id/m4b'">MAN 4 Banjar Learning Hub</h1>
  <p>Thinks Globally, Act Locally</p>
</header>

<input id="search" placeholder="Cari modul..." />
<div id="cards"></div>
<div id="pagination"></div>

<!-- POPUP VIEWER -->
<div id="viewerOverlay">
  <span class="closeBtn">&times;</span>
  <iframe src=""></iframe>
</div>

<footer>
  <p>Powered by <a href="https://arkanin.my.id" target="_blank">Arkanin</a></p>
</footer>

<script>
const DATA_URL = 'https://script.google.com/macros/s/AKfycbxP9Jun4DV7or8KJZAJ3hlEZ16J77GbK_v8vorluTjqI0Mp6nRRWPezpGWLRpEniUTthw/exec';
const cardsContainer = document.getElementById('cards');
const search = document.getElementById('search');
const paginationContainer = document.getElementById('pagination');
let allData = [];
let currentPage = 1;
const itemsPerPage = 50;

// POPUP
const overlay = document.getElementById('viewerOverlay');
const iframe = overlay.querySelector('iframe');
const closeBtn = overlay.querySelector('.closeBtn');
closeBtn.onclick = ()=>{ overlay.classList.remove('show'); iframe.src=''; }

function openViewer(file_id){
  iframe.src = `https://docs.google.com/gview?url=https://drive.google.com/uc?id=${file_id}&embedded=true`;
  overlay.classList.add('show');
}

// RENDER KARTU
function renderPage(page=1, data=allData){
  cardsContainer.innerHTML='';
  const start = (page-1)*itemsPerPage;
  const end = start+itemsPerPage;
  const pageData = data.slice(start,end);

  pageData.forEach(d=>{
    const div = document.createElement('div');
    // gunakan class kategori: jika kategori undefined, default lab
    const categoryClass = d.category?.toLowerCase() || 'lab';
    div.className=`card ${categoryClass}`;
    div.innerHTML = `
      <div class="card-icon">ðŸ“„</div>
      <h2>${d.title}</h2>
      <p>Klik untuk lihat modul</p>`;
    div.onclick = ()=>openViewer(d.file_id);
    cardsContainer.appendChild(div);
  });

  renderPagination(data, page);
}

// RENDER PAGINATION
function renderPagination(data, page){
  paginationContainer.innerHTML='';
  const pageCount = Math.ceil(data.length/itemsPerPage);
  if(pageCount<=1) return;
  for(let i=1;i<=pageCount;i++){
    const btn = document.createElement('button');
    btn.textContent=i;
    if(i===page) btn.classList.add('active');
    btn.onclick=()=>{ currentPage=i; renderPage(currentPage,data); window.scrollTo(0,0); };
    paginationContainer.appendChild(btn);
  }
}

// FETCH DATA
fetch(DATA_URL)
  .then(r=>r.json())
  .then(data=>{
    allData = data;
    renderPage(currentPage);
  });

// SEARCH
search.oninput=()=>{
  const q = search.value.toLowerCase();
  const filtered = allData.filter(d=>d.title.toLowerCase().includes(q));
  currentPage=1;
  renderPage(currentPage,filtered);
};
</script>

</body>
</html>
